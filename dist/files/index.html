<!DOCTYPE html>
<html class="flex" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload File</title>
    <link href="index.css" rel="stylesheet" type="text/css">
</head>
<script>
    const fetchWithProgress = (url, {method = 'GET', body} = {}, onProgress) => new Promise((res, rej) => {
        const xhr = new XMLHttpRequest();
        xhr.open(method, url);
        xhr.onload = res;
        xhr.onerror = rej;
        if (xhr.upload && onProgress) {
            xhr.upload.onprogress = onProgress;
        }
        xhr.send(body);
    });

    function onProgress({loaded, total}) {
        const percentage = Math.round((loaded * 100) / total);
        document.querySelector('.progress progress').setAttribute('value', `${percentage}`);
        if (percentage !== 100) {
            document.querySelector('.progress .uploading-percentage').textContent = `Uploading... ${percentage}%`;
            return;
        }
        document.querySelector('.progress .uploading-percentage').textContent = `Uploaded... ${percentage}%`;
    }

    function uploadFile(body) {
        document.querySelector('.progress .name').textContent = body.name;
        document.querySelector('.progress').style = 'display: flex';
        fetchWithProgress(`/files/${body.name}`, { method: 'Post', body}, onProgress);
    }
</script>
<body class="flex">
<div class="file-upload flex column justify-content-space-around">
   <span class="title">
            File upload
        </span>
    <div class="drop-zone flex column justify-content-space-between align-items-center">
        <img class="file-image" src="../images/icons8-add-file-48.png" />
        <div>
            Drag and drop or <a href="#">browse</a> your files
        </div>
        <input type="file" onchange="uploadFile(this.files[0])"/>
    </div>
    <div class="progress flex">
        <img src="../images/icons8-jpg-50.png"/>
        <div class="flex column flex1 justify-content-stretch">
            <span class="name"></span>
            <progress class="progress-bar" max="100" value="0">0 %</progress>
            <div class="flex justify-content-space-between">
                <span class="uploading-file-size">5.7 MB of 7.8 MB</span>
                <span class="uploading-percentage"></span>
            </div>
        </div>
    </div>
    <button class="done">DONE</button>
</div>
</body>
<script>
    document.querySelector('.file-upload .drop-zone').addEventListener('click', function ({target}) {
        const $fileInput = document.querySelector('.file-upload .drop-zone input[type=file]');
        if ($fileInput === target) {
            return;
        }
        $fileInput.click();
    });
</script>
</html>
